<div class="profile-page">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <div class="avatar-circle">
        <span class="avatar-text">{{ getInitials(profileData.name) }}</span>
      </div>
      <div class="avatar-status online"></div>
    </div>
    <div class="profile-info">
      <h1 class="profile-name">{{ profileData.name }}</h1>
      <p class="profile-title">{{ profileData.title }}</p>
      <div class="profile-meta">
        <span class="meta-item">
          <i class="icon-email"></i>
          {{ profileData.email }}
        </span>
        <span class="meta-item">
          <i class="icon-department"></i>
          {{ profileData.department }}
        </span>
        <span class="meta-item">
          <i class="icon-time"></i>
          Last active {{ profileData.lastActive }}
        </span>
      </div>
    </div>
    <div class="profile-actions">
      <button class="btn btn-outline" *ngIf="!isEditingProfile" (click)="editProfile()">
        <i class="icon-edit"></i>
        Edit Profile
      </button>
      <button class="btn btn-primary" *ngIf="isEditingProfile" (click)="saveProfile()">
        <i class="icon-check"></i>
        Save Changes
      </button>
      <button class="btn btn-outline" *ngIf="isEditingProfile" (click)="cancelEdit()">
        <i class="icon-close"></i>
        Cancel
      </button>
      <button class="btn btn-primary" *ngIf="!isEditingProfile" (click)="openSettings()">
        <i class="icon-settings"></i>
        Settings
      </button>
    </div>
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- Left Column -->
    <div class="profile-left">
      <!-- Personal Information Card -->
      <div class="profile-card">
      <div class="card-header">
        <div class="header-icon">
          <i class="icon-user"></i>
        </div>
        <div class="header-content">
          <h3>Personal Information</h3>
          <p>Manage your personal details and contact information</p>
        </div>
        <div class="header-actions" *ngIf="!isEditingPersonalInfo">
          <button class="btn-icon btn-edit" (click)="editPersonalInfo()" title="Edit Personal Information">
            <i class="icon-edit"></i>
          </button>
        </div>
        <div class="header-actions" *ngIf="isEditingPersonalInfo">
          <button class="btn-icon btn-save" (click)="savePersonalInfo()" title="Save Changes">
            <i class="icon-check"></i>
          </button>
          <button class="btn-icon btn-cancel" (click)="cancelEdit()" title="Cancel">
            <i class="icon-close"></i>
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">
              <i class="icon-user"></i>
              Full Name
            </div>
            <div class="info-value" *ngIf="!isEditingPersonalInfo">{{ profileData.name }}</div>
            <input type="text" class="info-input" *ngIf="isEditingPersonalInfo" 
                   [(ngModel)]="editableProfileData.name" placeholder="Enter full name">
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="icon-email"></i>
              Email Address
            </div>
            <div class="info-value" *ngIf="!isEditingPersonalInfo">{{ profileData.email }}</div>
            <input type="email" class="info-input" *ngIf="isEditingPersonalInfo" 
                   [(ngModel)]="editableProfileData.email" placeholder="Enter email address">
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="icon-phone"></i>
              Phone Number
            </div>
            <div class="info-value" *ngIf="!isEditingPersonalInfo">{{ profileData.phone }}</div>
            <input type="tel" class="info-input" *ngIf="isEditingPersonalInfo" 
                   [(ngModel)]="editableProfileData.phone" placeholder="Enter phone number">
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="icon-location"></i>
              Location
            </div>
            <div class="info-value" *ngIf="!isEditingPersonalInfo">{{ profileData.location }}</div>
            <input type="text" class="info-input" *ngIf="isEditingPersonalInfo" 
                   [(ngModel)]="editableProfileData.location" placeholder="Enter location">
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="icon-calendar"></i>
              Member Since
            </div>
            <div class="info-value">{{ profileData.memberSince }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="icon-badge"></i>
              Employee ID
            </div>
            <div class="info-value">{{ profileData.employeeId }}</div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- Right Column -->
    <div class="profile-right">
      <!-- Security Settings Card -->
    <div class="profile-card">
      <div class="card-header">
        <div class="header-icon security">
          <i class="icon-shield"></i>
        </div>
        <div class="header-content">
          <h3>Security Settings</h3>
          <p>Manage your account security and authentication</p>
        </div>
        <button class="btn-icon">
          <i class="icon-settings"></i>
        </button>
      </div>
      <div class="card-body">
        <div class="security-grid">
          <div class="security-item">
            <div class="security-icon">
              <i class="icon-shield-check"></i>
            </div>
            <div class="security-content">
              <h4>Two-Factor Authentication</h4>
              <p>Add an extra layer of security to your account</p>
              <div class="security-status" [class.enabled]="securitySettings.twoFactorAuth">
                <span class="status-dot"></span>
                {{ securitySettings.twoFactorAuth ? 'Enabled' : 'Disabled' }}
              </div>
            </div>
            <button class="btn-toggle" [class.active]="securitySettings.twoFactorAuth" (click)="toggleTwoFactorAuth()">
              <span class="toggle-slider"></span>
            </button>
          </div>
          
          <div class="security-item">
            <div class="security-icon">
              <i class="icon-key"></i>
            </div>
            <div class="security-content">
              <h4>Password</h4>
              <p>Last changed {{ securitySettings.lastPasswordChange }}</p>
              <div class="security-status">
                <span class="status-dot"></span>
                {{ securitySettings.passwordStrength }}
              </div>
            </div>
            <button class="btn-outline" (click)="changePassword()">Change</button>
          </div>
          
          <div class="security-item">
            <div class="security-icon">
              <i class="icon-clock"></i>
            </div>
            <div class="security-content">
              <h4>Session Timeout</h4>
              <p>Automatically log out after inactivity</p>
              <div class="security-status">
                <span class="status-dot"></span>
                {{ securitySettings.sessionTimeout }}
              </div>
            </div>
            <button class="btn-outline" (click)="configureSessionTimeout()">Configure</button>
          </div>
          
          <div class="security-item">
            <div class="security-icon">
              <i class="icon-device"></i>
            </div>
            <div class="security-content">
              <h4>Active Sessions</h4>
              <p>Manage your logged-in devices</p>
              <div class="security-status">
                <span class="status-dot"></span>
                {{ securitySettings.activeSessions }} devices
              </div>
            </div>
            <button class="btn-outline" (click)="viewActiveSessions()">View All</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Preferences Card -->
    <div class="profile-card">
      <div class="card-header">
        <div class="header-icon preferences">
          <i class="icon-settings"></i>
        </div>
        <div class="header-content">
          <h3>Preferences</h3>
          <p>Customize your experience and notifications</p>
        </div>
        <button class="btn-icon">
          <i class="icon-edit"></i>
        </button>
      </div>
      <div class="card-body">
        <div class="preferences-grid">
          <div class="preference-item">
            <div class="preference-content">
              <h4>Language & Region</h4>
              <p>{{ preferences.language }}</p>
            </div>
            <button class="btn-outline" (click)="changeLanguage()">Change</button>
          </div>
          
          <div class="preference-item">
            <div class="preference-content">
              <h4>Timezone</h4>
              <p>{{ preferences.timezone }}</p>
            </div>
            <button class="btn-outline" (click)="changeTimezone()">Change</button>
          </div>
          
          <div class="preference-item">
            <div class="preference-content">
              <h4>Theme</h4>
              <p>{{ preferences.theme }}</p>
            </div>
            <button class="btn-toggle" [class.active]="preferences.theme === 'Dark Mode'" (click)="toggleTheme()">
              <span class="toggle-slider"></span>
            </button>
          </div>
          
          <div class="preference-item">
            <div class="preference-content">
              <h4>Email Notifications</h4>
              <p>Security alerts and updates</p>
            </div>
            <button class="btn-toggle" [class.active]="preferences.emailNotifications" (click)="toggleEmailNotifications()">
              <span class="toggle-slider"></span>
            </button>
          </div>
          
          <div class="preference-item">
            <div class="preference-content">
              <h4>SMS Notifications</h4>
              <p>Critical security alerts only</p>
            </div>
            <button class="btn-toggle" [class.active]="preferences.smsNotifications" (click)="toggleSmsNotifications()">
              <span class="toggle-slider"></span>
            </button>
          </div>
          
          <div class="preference-item">
            <div class="preference-content">
              <h4>Dashboard Layout</h4>
              <p>{{ preferences.dashboardLayout }}</p>
            </div>
            <button class="btn-outline" (click)="customizeDashboard()">Customize</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity Card -->
    <div class="profile-card">
      <div class="card-header">
        <div class="header-icon activity">
          <i class="icon-activity"></i>
        </div>
        <div class="header-content">
          <h3>Recent Activity</h3>
          <p>Your latest actions and security events</p>
        </div>
        <button class="btn-outline">View All</button>
      </div>
      <div class="card-body">
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of recentActivity">
            <div class="activity-icon" [ngClass]="activity.icon">
              <i [class]="'icon-' + activity.icon"></i>
            </div>
            <div class="activity-content">
              <h4>{{ activity.title }}</h4>
              <p>{{ activity.description }}</p>
              <span class="activity-time">{{ activity.time }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Session Timeout Configuration Modal -->
  <div class="modal-overlay" [class.active]="showSessionTimeoutModal" (click)="cancelSessionTimeoutConfig()">
    <div class="modal-content session-timeout-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Configure Session Timeout</h3>
        <button class="close-btn" (click)="cancelSessionTimeoutConfig()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-description">
          Set how long your session will remain active when you're not using the application. 
          After this period of inactivity, you'll be automatically logged out for security.
        </p>
        <div class="timeout-options">
          <div class="timeout-option" 
               *ngFor="let option of sessionTimeoutOptions"
               [class.selected]="selectedSessionTimeout === option.value"
               (click)="selectedSessionTimeout = option.value">
            <div class="option-content">
              <span class="option-value">{{ option.value }}</span>
              <span class="option-detail">{{ option.minutes }} minutes</span>
            </div>
            <div class="option-check" *ngIf="selectedSessionTimeout === option.value">
              <i class="icon-check"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="cancelSessionTimeoutConfig()">Cancel</button>
        <button class="btn btn-primary" (click)="saveSessionTimeout()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal-overlay" [class.active]="showChangePasswordModal" (click)="closeChangePasswordModal()">
    <div class="modal-content change-password-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Change Password</h3>
        <button class="close-btn" (click)="closeChangePasswordModal()">&times;</button>
      </div>
      <div class="alert alert-danger" *ngIf="passwordChangeError">{{ passwordChangeError }}</div>
      <form class="change-password-form" (ngSubmit)="onSubmitChangePassword()">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input 
            type="password" 
            id="currentPassword" 
            [(ngModel)]="changePasswordData.currentPassword"
            name="currentPassword"
            placeholder="Enter your current password"
            required
            autocomplete="current-password">
        </div>
        
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input 
            type="password" 
            id="newPassword" 
            [(ngModel)]="changePasswordData.newPassword"
            (input)="checkPasswordStrength(changePasswordData.newPassword)"
            name="newPassword"
            placeholder="Enter new password"
            required
            autocomplete="new-password">
          
          <!-- Password Strength Indicator -->
          <div class="password-strength" *ngIf="changePasswordData.newPassword">
            <div class="strength-bar">
              <div class="strength-fill" 
                   [class.weak]="passwordStrengthText === 'Weak'"
                   [class.medium]="passwordStrengthText === 'Medium'"
                   [class.strong]="passwordStrengthText === 'Strong' || passwordStrengthText === 'Very Strong'"
                   [style.width.%]="getStrengthWidth()">
              </div>
            </div>
            <div class="strength-text" [class]="'strength-' + passwordStrengthText.toLowerCase().replace(' ', '-')">
              {{ passwordStrengthText }}
            </div>
            
            <!-- Password Requirements -->
            <div class="password-requirements">
              <div class="requirement" [class.met]="passwordStrength.length">
                <i class="icon-check" *ngIf="passwordStrength.length">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.length">○</span>
                At least 12 characters (max 128)
              </div>
              <div class="requirement" [class.met]="passwordStrength.uppercase">
                <i class="icon-check" *ngIf="passwordStrength.uppercase">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.uppercase">○</span>
                One uppercase letter
              </div>
              <div class="requirement" [class.met]="passwordStrength.lowercase">
                <i class="icon-check" *ngIf="passwordStrength.lowercase">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.lowercase">○</span>
                One lowercase letter
              </div>
              <div class="requirement" [class.met]="passwordStrength.number">
                <i class="icon-check" *ngIf="passwordStrength.number">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.number">○</span>
                One number
              </div>
              <div class="requirement" [class.met]="passwordStrength.special">
                <i class="icon-check" *ngIf="passwordStrength.special">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.special">○</span>
                One special character (!@#$%^&*...)
              </div>
              <div class="requirement" [class.met]="passwordStrength.notCommon">
                <i class="icon-check" *ngIf="passwordStrength.notCommon">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.notCommon">○</span>
                Not a common/weak password
              </div>
              <div class="requirement" [class.met]="passwordStrength.notSequential">
                <i class="icon-check" *ngIf="passwordStrength.notSequential">✓</i>
                <span class="check-placeholder" *ngIf="!passwordStrength.notSequential">○</span>
                No sequential or repeated characters
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input 
            type="password" 
            id="confirmPassword" 
            [(ngModel)]="changePasswordData.confirmPassword"
            name="confirmPassword"
            placeholder="Confirm new password"
            required
            autocomplete="new-password">
          <div class="password-match" *ngIf="changePasswordData.confirmPassword">
            <span class="match-text" 
                  [class.match]="changePasswordData.newPassword === changePasswordData.confirmPassword"
                  [class.mismatch]="changePasswordData.newPassword !== changePasswordData.confirmPassword && changePasswordData.confirmPassword.length > 0">
              <i class="icon-check" *ngIf="changePasswordData.newPassword === changePasswordData.confirmPassword">✓</i>
              <span *ngIf="changePasswordData.newPassword === changePasswordData.confirmPassword">Passwords match</span>
              <span *ngIf="changePasswordData.newPassword !== changePasswordData.confirmPassword && changePasswordData.confirmPassword.length > 0">Passwords do not match</span>
            </span>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-outline" (click)="closeChangePasswordModal()" [disabled]="isChangingPassword">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!isPasswordStrong() || changePasswordData.newPassword !== changePasswordData.confirmPassword || isChangingPassword">
            <span *ngIf="!isChangingPassword">Change Password</span>
            <span *ngIf="isChangingPassword">Changing Password...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Active Sessions Modal -->
  <div class="modal-overlay" [class.active]="showActiveSessionsModal" (click)="closeActiveSessionsModal()">
    <div class="modal-content active-sessions-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Active Sessions</h3>
        <button class="close-btn" (click)="closeActiveSessionsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-description">
          Review and manage all devices where you're currently logged in. You can terminate individual sessions or all other sessions for enhanced security.
        </p>
        
        <div class="sessions-list" *ngIf="activeSessions.length > 0">
          <div class="session-item" *ngFor="let session of activeSessions" [class.current-session]="session.isCurrent">
            <div class="session-info">
              <div class="session-header">
                <div class="session-device">
                  <i class="icon-device"></i>
                  <div>
                    <h4>{{ session.device }}</h4>
                    <span class="session-badge current" *ngIf="session.isCurrent">Current Session</span>
                  </div>
                </div>
                <button 
                  class="btn-terminate" 
                  *ngIf="!session.isCurrent"
                  (click)="terminateSession(session.id)"
                  title="Terminate this session">
                  <i class="icon-close"></i>
                  Terminate
                </button>
              </div>
              
              <div class="session-details">
                <div class="detail-row">
                  <span class="detail-label">
                    <i class="icon-browser"></i>
                    Browser:
                  </span>
                  <span class="detail-value">{{ session.browser }}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <i class="icon-location"></i>
                    Location:
                  </span>
                  <span class="detail-value">{{ session.location }}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <i class="icon-ip"></i>
                    IP Address:
                  </span>
                  <span class="detail-value">{{ session.ipAddress }}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <i class="icon-time"></i>
                    Last Active:
                  </span>
                  <span class="detail-value">{{ session.lastActive }}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">
                    <i class="icon-calendar"></i>
                    Login Time:
                  </span>
                  <span class="detail-value">{{ session.loginTime }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="no-sessions" *ngIf="activeSessions.length === 0">
          <i class="icon-device"></i>
          <p>No active sessions found.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="terminateAllOtherSessions()" [disabled]="!hasOtherSessions()">
          Terminate All Other Sessions
        </button>
        <button class="btn btn-primary" (click)="closeActiveSessionsModal()">Close</button>
      </div>
    </div>
  </div>
</div>
