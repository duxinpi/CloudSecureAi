<div class="page-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-text">
        <h1>üß≠ Resource Situation</h1>
        <p>Unified view of all resources across AWS, Azure, GCP, DigitalOcean, and more</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" (click)="refreshResources()">
          <i class="icon-refresh"></i>
          Sync All
        </button>
        <button class="btn btn-primary" (click)="openDiscoveryModal()">
          <i class="icon-search"></i>
          Discover Resources
        </button>
      </div>
    </div>
  </div>

  <!-- Filters and Controls -->
  <div class="filters-section">
    <div class="filter-group">
      <label>üîç Filter by Provider:</label>
      <select [(ngModel)]="selectedProvider" (change)="applyFilters()">
        <option value="">All Providers</option>
        <option value="AWS">AWS</option>
        <option value="Azure">Azure</option>
        <option value="GCP">GCP</option>
        <option value="DigitalOcean">DigitalOcean</option>
        <option value="Linode">Linode</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>üó∫Ô∏è Filter by Environment:</label>
      <select [(ngModel)]="selectedEnvironment" (change)="applyFilters()">
        <option value="">All Environments</option>
        <option value="production">Production</option>
        <option value="staging">Staging</option>
        <option value="development">Development</option>
        <option value="testing">Testing</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>üìç Filter by Region:</label>
      <select [(ngModel)]="selectedRegion" (change)="applyFilters()">
        <option value="">All Regions</option>
        <option value="us-east-1">US East 1</option>
        <option value="us-west-2">US West 2</option>
        <option value="eu-west-1">EU West 1</option>
        <option value="ap-southeast-1">AP Southeast 1</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>üè∑Ô∏è Filter by Project:</label>
      <select [(ngModel)]="selectedProject" (change)="applyFilters()">
        <option value="">All Projects</option>
        <option value="web-app">Web Application</option>
        <option value="data-analytics">Data Analytics</option>
        <option value="ml-pipeline">ML Pipeline</option>
        <option value="infrastructure">Infrastructure</option>
      </select>
    </div>
  </div>

  <!-- Overview Stats -->
  <div class="overview-stats">
    <div class="stat-card total">
      <div class="stat-icon">
        <i class="icon-cloud"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ totalResources }}</div>
        <div class="stat-label">Total Resources</div>
      </div>
    </div>
    
    <div class="stat-card running">
      <div class="stat-icon">
        <i class="icon-check"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ runningResources }}</div>
        <div class="stat-label">Running</div>
      </div>
    </div>
    
    <div class="stat-card stopped">
      <div class="stat-icon">
        <i class="icon-warning"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">{{ stoppedResources }}</div>
        <div class="stat-label">Stopped</div>
      </div>
    </div>
    
    <div class="stat-card cost">
      <div class="stat-icon">
        <i class="icon-dollar"></i>
      </div>
      <div class="stat-content">
        <div class="stat-number">${{ totalCost | number:'1.2-2' }}</div>
        <div class="stat-label">Monthly Cost</div>
      </div>
    </div>
  </div>

  <!-- Resource Grid -->
  <div class="resources-grid">
    <div class="resource-card" *ngFor="let resource of filteredResources" [class]="getResourceStatusClass(resource.status)">
      <div class="resource-header">
        <div class="resource-icon" [class]="'provider-' + resource.provider.toLowerCase()">
          <i [class]="'icon-' + resource.provider.toLowerCase()"></i>
        </div>
        <div class="resource-info">
          <h3>{{ resource.name }}</h3>
          <p class="resource-type">{{ resource.type }}</p>
          <p class="resource-id">{{ resource.id }}</p>
        </div>
        <div class="resource-status">
          <span class="status-badge" [class]="resource.status.toLowerCase()">{{ resource.status }}</span>
          <div class="health-indicator" [class]="resource.health.toLowerCase()"></div>
        </div>
      </div>
      
      <div class="resource-details">
        <div class="detail-row">
          <span class="label">Provider:</span>
          <span class="value">{{ resource.provider }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Region:</span>
          <span class="value">{{ resource.region }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Environment:</span>
          <span class="value">{{ resource.environment }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Project:</span>
          <span class="value">{{ resource.project }}</span>
        </div>
        <div class="detail-row" *ngIf="resource.cost">
          <span class="label">Cost:</span>
          <span class="value cost">${{ resource.cost | number:'1.2-2' }}/month</span>
        </div>
      </div>
      
      <div class="resource-tags" *ngIf="resource.tags && resource.tags.length > 0">
        <span class="tag" *ngFor="let tag of resource.tags">{{ tag }}</span>
      </div>
      
      <div class="resource-metrics" *ngIf="resource.metrics">
        <div class="metric">
          <span class="metric-label">CPU:</span>
          <div class="metric-bar">
            <div class="metric-fill" [style.width.%]="resource.metrics.cpu"></div>
          </div>
          <span class="metric-value">{{ resource.metrics.cpu }}%</span>
        </div>
        <div class="metric">
          <span class="metric-label">Memory:</span>
          <div class="metric-bar">
            <div class="metric-fill" [style.width.%]="resource.metrics.memory"></div>
          </div>
          <span class="metric-value">{{ resource.metrics.memory }}%</span>
        </div>
      </div>
      
      <div class="resource-actions">
        <button class="btn btn-sm btn-outline" (click)="viewResourceDetails(resource)">
          <i class="icon-eye"></i>
          View
        </button>
        <button class="btn btn-sm btn-outline" (click)="manageResource(resource)">
          <i class="icon-settings"></i>
          Manage
        </button>
        <button class="btn btn-sm btn-outline" (click)="viewLogs(resource)">
          <i class="icon-file"></i>
          Logs
        </button>
      </div>
    </div>
  </div>

  <!-- No Resources State -->
  <div class="empty-state" *ngIf="filteredResources.length === 0">
    <div class="empty-icon">
      <i class="icon-cloud"></i>
    </div>
    <h3>No Resources Found</h3>
    <p>No resources match your current filters. Try adjusting your search criteria.</p>
    <button class="btn btn-primary" (click)="clearFilters()">
      <i class="icon-refresh"></i>
      Clear Filters
    </button>
  </div>

  <!-- Security & Access Control Panel -->
  <div class="security-panel" *ngIf="showSecurityPanel">
    <div class="panel-header">
      <h3>üîí Security & Access Control</h3>
      <button class="close-btn" (click)="toggleSecurityPanel()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="panel-content">
      <div class="security-section">
        <h4>Central IAM Management</h4>
        <div class="iam-grid">
          <div class="iam-card">
            <h5>AWS IAM</h5>
            <p>Users: {{ iamStats.aws.users }}</p>
            <p>Roles: {{ iamStats.aws.roles }}</p>
            <p>Policies: {{ iamStats.aws.policies }}</p>
          </div>
          <div class="iam-card">
            <h5>Azure AD</h5>
            <p>Users: {{ iamStats.azure.users }}</p>
            <p>Groups: {{ iamStats.azure.groups }}</p>
            <p>Applications: {{ iamStats.azure.applications }}</p>
          </div>
          <div class="iam-card">
            <h5>GCP IAM</h5>
            <p>Users: {{ iamStats.gcp.users }}</p>
            <p>Service Accounts: {{ iamStats.gcp.serviceAccounts }}</p>
            <p>Custom Roles: {{ iamStats.gcp.customRoles }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Monitoring & Alerts Panel -->
  <div class="monitoring-panel" *ngIf="showMonitoringPanel">
    <div class="panel-header">
      <h3>üìà Monitoring & Alerts</h3>
      <button class="close-btn" (click)="toggleMonitoringPanel()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="panel-content">
      <div class="monitoring-section">
        <h4>Health Metrics</h4>
        <div class="metrics-grid">
          <div class="metric-card">
            <h5>CPU Usage</h5>
            <div class="metric-chart">
              <div class="chart-bar" [style.width.%]="healthMetrics.cpu"></div>
            </div>
            <span class="metric-value">{{ healthMetrics.cpu }}%</span>
          </div>
          <div class="metric-card">
            <h5>Memory Usage</h5>
            <div class="metric-chart">
              <div class="chart-bar" [style.width.%]="healthMetrics.memory"></div>
            </div>
            <span class="metric-value">{{ healthMetrics.memory }}%</span>
          </div>
          <div class="metric-card">
            <h5>Disk Usage</h5>
            <div class="metric-chart">
              <div class="chart-bar" [style.width.%]="healthMetrics.disk"></div>
            </div>
            <span class="metric-value">{{ healthMetrics.disk }}%</span>
          </div>
        </div>
      </div>
      
      <div class="alerts-section">
        <h4>Active Alerts</h4>
        <div class="alerts-list">
          <div class="alert-item" *ngFor="let alert of activeAlerts" [class]="'alert-' + alert.severity">
            <div class="alert-icon">
              <i [class]="'icon-' + alert.type"></i>
            </div>
            <div class="alert-content">
              <h5>{{ alert.title }}</h5>
              <p>{{ alert.description }}</p>
              <span class="alert-time">{{ alert.timestamp | date:'short' }}</span>
            </div>
            <div class="alert-actions">
              <button class="btn btn-sm" (click)="acknowledgeAlert(alert)">Acknowledge</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Timeline -->
  <div class="timeline-panel" *ngIf="showTimelinePanel">
    <div class="panel-header">
      <h3>üïí Event Timeline</h3>
      <button class="close-btn" (click)="toggleTimelinePanel()">
        <i class="icon-close"></i>
      </button>
    </div>
    <div class="panel-content">
      <div class="timeline">
        <div class="timeline-item" *ngFor="let event of timelineEvents" [class]="'timeline-' + event.type">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <h5>{{ event.title }}</h5>
            <p>{{ event.description }}</p>
            <span class="timeline-time">{{ event.timestamp | date:'medium' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Viewer -->
  <div class="log-viewer-overlay" *ngIf="showLogViewer" (click)="closeLogViewerOnBackdrop()">
    <div class="log-viewer" (click)="$event.stopPropagation()">
      <div class="viewer-header">
        <h3>üß≠ Log Viewer</h3>
        <div class="viewer-controls">
          <select [(ngModel)]="selectedLogLevel">
            <option value="">All Levels</option>
            <option value="error">Error</option>
            <option value="warning">Warning</option>
            <option value="info">Info</option>
            <option value="debug">Debug</option>
          </select>
          <button class="btn btn-sm" (click)="refreshLogs()">
            <i class="icon-refresh"></i>
            Refresh
          </button>
          <button class="close-btn" (click)="toggleLogViewer()">
            <i class="icon-close"></i>
          </button>
        </div>
      </div>
      <div class="log-content">
        <div class="log-entry" *ngFor="let log of filteredLogs" [class]="'log-' + log.level">
          <span class="log-time">{{ log.timestamp | date:'HH:mm:ss' }}</span>
          <span class="log-level">{{ log.level.toUpperCase() }}</span>
          <span class="log-message">{{ log.message }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Resource Details Modal -->
  <div class="modal-overlay" *ngIf="showResourceDetailsModal" (click)="closeResourceDetailsModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i [class]="selectedResource ? 'icon-' + selectedResource.provider.toLowerCase() : ''"></i>
          {{ selectedResource?.name }}
        </h3>
        <button class="close-btn" (click)="closeResourceDetailsModal()">
          <i class="icon-close"></i>
        </button>
      </div>
      
      <div class="modal-body" *ngIf="selectedResource">
        <!-- Resource Overview -->
        <div class="resource-detail-section">
          <h4>üìã Overview</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Resource ID:</span>
              <span class="value">{{ selectedResource.id }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Type:</span>
              <span class="value">{{ selectedResource.type }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Provider:</span>
              <span class="value">{{ selectedResource.provider }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Status:</span>
              <span class="value status-badge" [class]="selectedResource.status.toLowerCase()">
                {{ selectedResource.status }}
              </span>
            </div>
            <div class="detail-item">
              <span class="label">Health:</span>
              <span class="value health-indicator" [class]="selectedResource.health.toLowerCase()">
                {{ selectedResource.health }}
              </span>
            </div>
            <div class="detail-item">
              <span class="label">Region:</span>
              <span class="value">{{ selectedResource.region }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Environment:</span>
              <span class="value">{{ selectedResource.environment }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Project:</span>
              <span class="value">{{ selectedResource.project }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedResource.cost">
              <span class="label">Monthly Cost:</span>
              <span class="value cost">${{ selectedResource.cost | number:'1.2-2' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedResource.createdAt">
              <span class="label">Created:</span>
              <span class="value">{{ selectedResource.createdAt | date:'medium' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedResource.lastSync">
              <span class="label">Last Sync:</span>
              <span class="value">{{ selectedResource.lastSync | date:'medium' }}</span>
            </div>
          </div>
        </div>

        <!-- Resource Metrics -->
        <div class="resource-detail-section" *ngIf="selectedResource.metrics">
          <h4>üìä Performance Metrics</h4>
          <div class="metrics-detail">
            <div class="metric-detail-item">
              <div class="metric-header">
                <span class="metric-label">CPU Usage</span>
                <span class="metric-value">{{ selectedResource.metrics.cpu }}%</span>
              </div>
              <div class="metric-bar">
                <div class="metric-fill" [style.width.%]="selectedResource.metrics.cpu" 
                     [class]="getMetricClass(selectedResource.metrics.cpu)"></div>
              </div>
            </div>
            <div class="metric-detail-item">
              <div class="metric-header">
                <span class="metric-label">Memory Usage</span>
                <span class="metric-value">{{ selectedResource.metrics.memory }}%</span>
              </div>
              <div class="metric-bar">
                <div class="metric-fill" [style.width.%]="selectedResource.metrics.memory"
                     [class]="getMetricClass(selectedResource.metrics.memory)"></div>
              </div>
            </div>
            <div class="metric-detail-item" *ngIf="selectedResource.metrics.disk">
              <div class="metric-header">
                <span class="metric-label">Disk Usage</span>
                <span class="metric-value">{{ selectedResource.metrics.disk }}%</span>
              </div>
              <div class="metric-bar">
                <div class="metric-fill" [style.width.%]="selectedResource.metrics.disk"
                     [class]="getMetricClass(selectedResource.metrics.disk)"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Tags -->
        <div class="resource-detail-section" *ngIf="selectedResource.tags && selectedResource.tags.length > 0">
          <h4>üè∑Ô∏è Tags</h4>
          <div class="tags-container">
            <span class="tag" *ngFor="let tag of selectedResource.tags">{{ tag }}</span>
          </div>
        </div>

        <!-- Related Alerts -->
        <div class="resource-detail-section" *ngIf="getResourceAlerts(selectedResource.id).length > 0">
          <h4>‚ö†Ô∏è Active Alerts</h4>
          <div class="alerts-container">
            <div class="alert-item" *ngFor="let alert of getResourceAlerts(selectedResource.id)" 
                 [class]="'alert-' + alert.severity">
              <div class="alert-icon">
                <i [class]="'icon-' + alert.type"></i>
              </div>
              <div class="alert-content">
                <h5>{{ alert.title }}</h5>
                <p>{{ alert.description }}</p>
                <span class="alert-time">{{ alert.timestamp | date:'short' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Related Events -->
        <div class="resource-detail-section" *ngIf="getResourceEvents(selectedResource.id).length > 0">
          <h4>üïí Recent Events</h4>
          <div class="events-container">
            <div class="event-item" *ngFor="let event of getResourceEvents(selectedResource.id)"
                 [class]="'event-' + event.type">
              <div class="event-marker"></div>
              <div class="event-content">
                <h5>{{ event.title }}</h5>
                <p>{{ event.description }}</p>
                <span class="event-time">{{ event.timestamp | date:'medium' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer" *ngIf="selectedResource">
        <button class="btn btn-outline" (click)="viewLogs(selectedResource)">
          <i class="icon-file"></i>
          View Logs
        </button>
        <button class="btn btn-outline" (click)="manageResource(selectedResource)">
          <i class="icon-settings"></i>
          Manage
        </button>
        <button class="btn btn-primary" (click)="closeResourceDetailsModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Resource Discovery Modal -->
  <div class="modal-overlay" *ngIf="showDiscoveryModal" (click)="closeDiscoveryModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="icon-search"></i>
          Discover Resources
        </h3>
        <button class="close-btn" (click)="closeDiscoveryModal()" *ngIf="discoveryStatus !== 'discovering'">
          <i class="icon-close"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <!-- Discovery Configuration -->
        <div class="discovery-config" *ngIf="discoveryStatus === 'idle'">
          <div class="form-section">
            <h4>Select Cloud Providers</h4>
            <p class="section-description">Choose which cloud providers to scan for resources</p>
            <div class="provider-selection">
              <div class="provider-option" 
                   *ngFor="let provider of availableProviders"
                   [class.selected]="isProviderSelected(provider)"
                   (click)="toggleProvider(provider)">
                <div class="provider-icon" [class]="'provider-' + provider.toLowerCase()">
                  <i [class]="'icon-' + provider.toLowerCase()"></i>
                </div>
                <span class="provider-name">{{ provider }}</span>
                <i class="check-icon" *ngIf="isProviderSelected(provider)">‚úì</i>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h4>Select Regions (Optional)</h4>
            <p class="section-description">Leave empty to scan all regions, or select specific regions</p>
            <div class="region-selection">
              <div class="region-option"
                   *ngFor="let region of availableRegions"
                   [class.selected]="isRegionSelected(region)"
                   (click)="toggleRegion(region)">
                <span>{{ region }}</span>
                <i class="check-icon" *ngIf="isRegionSelected(region)">‚úì</i>
              </div>
            </div>
          </div>
        </div>

        <!-- Discovery Progress -->
        <div class="discovery-progress" *ngIf="discoveryStatus === 'discovering'">
          <div class="progress-icon-wrapper">
            <i class="icon-search spinning"></i>
          </div>
          <div class="progress-content">
            <p class="progress-message">{{ discoveryMessage }}</p>
            <div class="progress-bar-container">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="discoveryProgress"></div>
              </div>
              <span class="progress-percent">{{ discoveryProgress }}%</span>
            </div>
          </div>
        </div>

        <!-- Discovery Results -->
        <div class="discovery-results" *ngIf="discoveryStatus === 'completed'">
          <div class="result-header">
            <div class="result-icon success">
              <i class="icon-check"></i>
            </div>
            <div class="result-info">
              <h4>Discovery Complete!</h4>
              <p>{{ discoveryMessage }}</p>
            </div>
          </div>
          
          <div class="discovered-resources-list" *ngIf="discoveredResources.length > 0">
            <h5>Discovered Resources:</h5>
            <div class="resource-item" *ngFor="let resource of discoveredResources">
              <div class="resource-icon-small" [class]="'provider-' + resource.provider.toLowerCase()">
                <i [class]="'icon-' + resource.provider.toLowerCase()"></i>
              </div>
              <div class="resource-info-small">
                <span class="resource-name">{{ resource.name }}</span>
                <span class="resource-type">{{ resource.type }} - {{ resource.region }}</span>
              </div>
              <span class="resource-status" [class]="resource.status.toLowerCase()">{{ resource.status }}</span>
            </div>
          </div>
        </div>

        <!-- Discovery Error -->
        <div class="discovery-error" *ngIf="discoveryStatus === 'error'">
          <div class="error-icon">
            <i class="icon-error"></i>
          </div>
          <p class="error-message">{{ discoveryMessage }}</p>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-outline" 
                (click)="closeDiscoveryModal()" 
                *ngIf="discoveryStatus !== 'discovering'">
          {{ discoveryStatus === 'completed' ? 'Close' : 'Cancel' }}
        </button>
        <button class="btn btn-primary" 
                (click)="startDiscovery()" 
                *ngIf="discoveryStatus === 'idle'"
                [disabled]="discoveryProviders.length === 0">
          <i class="icon-search"></i>
          Start Discovery
        </button>
        <button class="btn btn-primary" 
                (click)="closeDiscoveryModal()" 
                *ngIf="discoveryStatus === 'completed'">
          Done
        </button>
      </div>
    </div>
  </div>
</div>
